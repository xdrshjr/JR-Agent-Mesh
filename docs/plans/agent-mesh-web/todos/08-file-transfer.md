# TODO: 08 â€” æ–‡ä»¶ä¼ è¾“

> å¯¹åº” Spec: `specs/08-file-transfer.md`

## æ–‡ä»¶ä¸Šä¼ 

- [ ] å®ç° `POST /api/upload` â€” æ–‡ä»¶ä¸Šä¼  APIï¼ˆmultipart/form-dataï¼‰
- [ ] å®‰è£… multer æˆ– formidable å¤„ç†æ–‡ä»¶ä¸Šä¼ 
- [ ] å®ç°æ–‡ä»¶å­˜å‚¨é€»è¾‘ï¼ˆdata/uploads/{fileId}/{filename}ï¼‰
- [ ] å®ç°ä¸Šä¼ é™åˆ¶æ ¡éªŒï¼ˆå•æ–‡ä»¶ 50MB, æ€»é‡ 200MB, æœ€å¤š 10 ä¸ªï¼‰
- [ ] ä¸Šä¼ å®Œæˆåè®°å½•åˆ° file_transfers è¡¨

## æ–‡ä»¶ä¸‹è½½

- [ ] å®ç° `GET /api/download/:fileId` â€” æ–‡ä»¶ä¸‹è½½ API
- [ ] éªŒè¯ fileId å­˜åœ¨ä¸”æœªè¿‡æœŸ
- [ ] è®¾ç½®æ­£ç¡®çš„ Content-Disposition å’Œ Content-Type å“åº”å¤´
- [ ] æ›´æ–°ä¸‹è½½çŠ¶æ€ä¸º completed

## è‡ªèº« Agent file_transfer å·¥å…·

- [ ] å®ç° `server/services/file-transfer.ts` â€” FileTransferService ç±»
- [ ] å®ç°æ–‡ä»¶å‡†å¤‡é€»è¾‘ï¼ˆä»æºè·¯å¾„å¤åˆ¶åˆ° data/downloads/{fileId}/ï¼‰
- [ ] å®ç° WebSocket é€šçŸ¥å‰ç«¯ï¼ˆchat.file_ready æ¶ˆæ¯ï¼‰
- [ ] å°†æ­¤æœåŠ¡æ³¨å…¥åˆ°è‡ªèº« Agent çš„ file_transfer å·¥å…·ä¸­

## å‰ç«¯ä¸Šä¼ äº¤äº’

- [ ] InputArea é™„ä»¶æŒ‰é’®ï¼ˆğŸ“ï¼‰ç‚¹å‡»æ‰“å¼€æ–‡ä»¶é€‰æ‹©å™¨
- [ ] æ‹–æ‹½ä¸Šä¼ æ”¯æŒï¼ˆonDragOver/onDrop å¤„ç†ï¼‰
- [ ] å›¾ç‰‡ç²˜è´´æ”¯æŒï¼ˆonPaste å¤„ç† clipboardDataï¼‰
- [ ] å·²é€‰é™„ä»¶é¢„è§ˆæ¡ï¼ˆæ–‡ä»¶å + å¤§å° + åˆ é™¤æŒ‰é’®ï¼‰
- [ ] ä¸Šä¼ è¿›åº¦æ˜¾ç¤ºï¼ˆXMLHttpRequest.upload.onprogress æˆ– fetch + ReadableStreamï¼‰
- [ ] ä¸Šä¼ è¶…é™æç¤ºï¼ˆå¤§å°/æ•°é‡è¶…é™æ—¶å‰ç«¯ç›´æ¥æ‹¦æˆªï¼‰

## å‰ç«¯ä¸‹è½½äº¤äº’

- [ ] FileAttachment ç»„ä»¶ç‚¹å‡»è§¦å‘ä¸‹è½½ï¼ˆwindow.open æˆ– a[download]ï¼‰
- [ ] æ ¹æ®æ–‡ä»¶ç±»å‹æ˜¾ç¤ºä¸åŒå›¾æ ‡
- [ ] å›¾ç‰‡æ–‡ä»¶æ”¯æŒå†…è”é¢„è§ˆï¼ˆ<img> åŠ è½½ /api/download/{fileId}ï¼‰
- [ ] ä»£ç æ–‡ä»¶æ”¯æŒå±•å¼€é¢„è§ˆï¼ˆè¯»å–å†…å®¹åä»£ç é«˜äº®æ˜¾ç¤ºï¼‰

## æ–‡ä»¶æ¸…ç†

- [ ] å®ç°è¿‡æœŸæ–‡ä»¶è‡ªåŠ¨æ¸…ç†ï¼ˆ24 å°æ—¶æœªä¸‹è½½çš„ pending æ–‡ä»¶ï¼‰
- [ ] å®ç°å·²å®Œæˆæ–‡ä»¶å»¶è¿Ÿæ¸…ç†ï¼ˆ7 å¤©åæ¸…ç† completed æ–‡ä»¶ï¼‰
- [ ] é›†æˆåˆ° 06-data-persistence ä¸­çš„å®šæ—¶æ¸…ç†ä»»åŠ¡
